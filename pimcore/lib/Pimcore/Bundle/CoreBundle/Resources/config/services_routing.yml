services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    #
    # ROUTING
    #

    # route provider for the CMF dynamic router
    Pimcore\Routing\DynamicRouteProvider:
        arguments: ['@pimcore.service.request.site_resolver']
        calls:
            - [addHandler, ['@Pimcore\Routing\Dynamic\DocumentRouteHandler']]

    # specific document related dynamic routing handling
    Pimcore\Routing\Dynamic\DocumentRouteHandler:
        arguments:
            - '@pimcore.document_service'
            - '@pimcore.service.request.site_resolver'
            - '@pimcore.http.request_helper'
            - '@pimcore.controller.config.config_normalizer'

    # alias the request context as public service
    pimcore.routing.router.request_context:
        alias: router.request_context
        public: true

    # dedicated router for static routes
    Pimcore\Routing\Staticroute\Router:
        arguments:
            - '@router.request_context'
            - '@pimcore.controller.config.config_normalizer'
        calls:
            - [setLocaleParams, ['%pimcore.routing.static.locale_params%']]
            - [setLogger, ['@logger']]
        tags:
            - { name: router, priority: 100 }
            - { name: monolog.logger, channel: routing }

    # routing loader for bundle routing auto loading
    Pimcore\Routing\Loader\BundleRoutingLoader:
        arguments: ['@pimcore.bundle_config_locator']
        tags:
            - { name: routing.loader }

    # redirect handler used to handle redirects before/after routing
    Pimcore\Routing\RedirectHandler:
        calls:
            - [setLogger, ['@logger']]
        tags:
            - { name: monolog.logger, channel: routing }
