services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    #
    # REQUEST + ROUTING
    #

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\FrontendRoutingListener:
        arguments:
            - '@pimcore.http.request_helper'
            - '@Pimcore\Routing\RedirectHandler'
            - '@pimcore.service.request.site_resolver'

    Pimcore\Bundle\CoreBundle\EventListener\PimcoreContextListener:
        arguments:
            - '@pimcore.service.request.pimcore_context_resolver'
            - '@request_stack'
        calls:
            - [setLogger, ['@logger']]

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\DocumentFallbackListener:
        arguments:
            - '@request_stack'
            - '@pimcore.service.request.document_resolver'
            - '@pimcore.service.request.site_resolver'
            - '@Pimcore\Model\Document\Service'

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\LocaleListener: ~

    Pimcore\Bundle\CoreBundle\EventListener\PimcoreHeaderListener: ~


    #
    # PIMCORE OBJECTS/PARAMS LOGIC
    #

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\ElementListener:
        arguments:
            - '@pimcore.service.request.document_resolver'
            - '@pimcore.service.request.editmode_resolver'
            - '@pimcore.http.request_helper'
            - '@pimcore_admin.security.user_loader'
        calls:
            - [setLogger, ['@logger']]
        tags:
            - { name: monolog.logger, channel: init }

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\HardlinkCanonicalListener:
        arguments: ['@pimcore.service.request.document_resolver']
        tags:
            - { name: kernel.event_subscriber }

    #
    # STATE HANDLING/INITIALIZING
    #

    # handles block state (current block, current index) for sub-requests
    Pimcore\Bundle\CoreBundle\EventListener\Frontend\BlockStateListener:
        arguments: ['@pimcore.document.tag.block_state_stack']
        calls:
            - [setLogger, ['@logger']]

    # Adds Meta Data entries of document to HeadMeta view helper
    Pimcore\Bundle\CoreBundle\EventListener\Frontend\DocumentMetaDataListener:
        arguments:
            - '@pimcore.service.request.document_resolver'
            - '@Pimcore\Templating\Helper\HeadMeta'


    #
    # CONTROLLER HANDLING
    #

    Pimcore\Bundle\CoreBundle\EventListener\ControllerViewModelListener:
        arguments:
            - '@pimcore.service.request.view_model_resolver'

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\ContentTemplateListener:
        arguments:
            - '@pimcore.service.request.template_resolver'

    Pimcore\Bundle\CoreBundle\EventListener\EventedControllerListener: ~

    Pimcore\Bundle\CoreBundle\EventListener\TemplateControllerListener:
        arguments:
            - '@service_container'


    #
    # VARIOUS MODEL SPECIFIC LISTENERS
    #

    Pimcore\Bundle\CoreBundle\EventListener\WorkflowManagementListener:
        public: true # can be disabled

    Pimcore\Bundle\CoreBundle\EventListener\ElementTagsListener: ~

    Pimcore\Bundle\CoreBundle\EventListener\SearchBackendListener: ~

    Pimcore\Bundle\CoreBundle\EventListener\UUIDListener: ~


    #
    # EXCEPTION HANDLING
    #

    Pimcore\Bundle\CoreBundle\EventListener\ResponseExceptionListener:
        arguments:
            - '@Pimcore\Templating\Renderer\ActionRenderer'
            - '%pimcore.response_exception_listener.render_error_document%'
        calls:
            - [setLogger, ['@logger']]


    #
    # RESPONSE TRANSFORMING
    #

    Pimcore\Bundle\CoreBundle\EventListener\ResponseHeaderListener:
        arguments:
            - '@pimcore.service.request.response_header_resolver'

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\EditmodeListener:
        arguments:
            - '@pimcore.service.request.editmode_resolver'
            - '@pimcore.service.request.document_resolver'
            - '@pimcore_admin.security.user_loader'
            - '@pimcore.extension.bundle_manager'
        calls:
            - [setLogger, ['@logger']]


    #
    # FRONTEND LISTENERS
    #

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\InternalWysiwygHtmlAttributeFilterListener: ~

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\GoogleAnalyticsCodeListener:
        public: true
        tags:
            - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: -110 }

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\CookiePolicyNoticeListener:
        public: true
        arguments: ['@kernel']
        calls:
            - [loadTemplateFromResource, ['@@PimcoreCoreBundle/Resources/misc/cookie-policy-default-template.html']]
            - [setTranslator, ['@translator']]
        tags:
            - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: -109 }

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\GoogleTagManagerListener:
        public: true
        tags:
            - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: -108 }

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\TagManagerListener:
        public: true
        tags:
            - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: -107 }

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\TargetingListener:
        public: true
        arguments:
            - '@pimcore.service.request.document_resolver'
        tags:
            - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: -106 }

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\FullPageCacheListener:
        public: true
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 600 }
            - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: -120 }
            - { name: kernel.event_listener, event: kernel.response, method: stopPropagationCheck, priority: 100 }

    Pimcore\Bundle\CoreBundle\EventListener\MaintenancePageListener:
        arguments:
            - '@kernel'
        calls:
            - [loadTemplateFromResource, ['@@PimcoreCoreBundle/Resources/misc/maintenance.html']]
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 620 }

    Pimcore\Bundle\CoreBundle\EventListener\Frontend\GoogleSearchConsoleVerificationListener: ~

